---
title: "Untitled"
output: pdf_document
date: "2023-10-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r UniversalBank}

UniversalBank <- read.csv("C:\\Users\\13308\\OneDrive\\Documents\\UniversalBank.csv")

data <- UniversalBank

library(caret)
library(class)

Loan_normalized <- data[, -1]
Loan_normalized <- Loan_normalized[,-4]

str(Loan_normalized)

norm_model <- preProcess(Loan_normalized, method = c('range'))
Loan_normalized <- predict(norm_model,Loan_normalized)


Index_Train <- createDataPartition(Loan_normalized$`Personal.Loan`, p=0.6, list=FALSE)
Train <- Loan_normalized[Index_Train,]
Validation <- Loan_normalized[-Index_Train,]

Train_Predictors <- Train[1:3000, c(1:7, 9:12)]
Val_Predictors <- Validation[1:2000, c(1:7, 9:12)]


Train_labels <- Train[, 8]
Val_labels <- Validation [, 8]

set.seed(123)

Predicted_Val_labels <- knn(Train_Predictors,
                             Val_Predictors,
                             cl=Train_labels,
                             k = 1)

new_data <- data.frame(
  Age = c(40),
  Experience = c(10),
  Income = c(84),
  Family = c(2),
  CCAvg = c(2),
  Education = c(2),
  Mortgage = c(0),
  "Securities Account" = c(0),
  "CD Account" = c(0),
  Online = c(1),
  CreditCard = c(1)
)

names(new_data) <- c("Age","Experience","Income","Family","CCAvg","Education","Mortgage","Securities Account","CD Account","Online","CreditCard")  
new_data

norm_model2 <- preProcess(new_data, method = c('range'))

new_data_normalized <- predict(norm_model2, new_data)

print("any")

predicted_loan_status <- knn(
  Train_Predictors,
  new_data_normalized,
  cl = Train_labels,
  k = 1
)

print(predicted_loan_status)

#1: This customer would accept a loan offer (1).
#2:

k_values <- seq(1, 50, by = 1) 

results <- data.frame(k = numeric(length(k_values)), Accuracy = numeric(length(k_values)))


for (i in 1:length(k_values)) {
  set.seed(123)  
  
  Predicted_Test_labels <- knn(
    Train_Predictors,
    Val_Predictors,
    cl = Train_labels,
    k = k_values[i]
  )
  
  accuracy <- sum(Predicted_Val_labels == Val_labels) / length(Val_labels)
  
  results[i, ] <- c(k = k_values[i], Accuracy = accuracy)
}

best_k <- results[which.max(results$Accuracy), "k"]
print(paste("Best k value:", best_k))
print(paste("Best accuracy:", max(results$Accuracy)))

#2: Per above, the best k value is 1.
#3:

library(gmodels)
CrossTable(x=Val_labels,y=Predicted_Val_labels, prop.chisq = FALSE)

#4:

new_data <- data.frame(
  Age = c(40),
  Experience = c(10),
  Income = c(84),
  Family = c(2),
  CCAvg = c(2),
  Education = c(2),
  Mortgage = c(0),
  "Securities Account" = c(0),
  "CD Account" = c(0),
  Online = c(1),
  CreditCard = c(1)
)

names(new_data) <- c("Age","Experience","Income","Family","CCAvg","Education","Mortgage","Securities Account","CD Account","Online","CreditCard")  
new_data

norm_model2 <- preProcess(new_data, method = c('range'))

new_data_normalized <- predict(norm_model2, new_data)

print("any")

predicted_loan_status <- knn(
  Train_Predictors,
  new_data_normalized,
  cl = Train_labels,
  k = 1
)

print(predicted_loan_status)

#4: This customer would also accept a loan offer (1), however it is worth noting that the customer information is identical to that of problem 1, with the same k value.

```

